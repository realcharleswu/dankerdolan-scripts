#!/usr/bin/bash
FINAL_STATUS=""
VPN_PATH=""
no_args=false
one_arg=false
two_args=false
usage0="Usage:"
usage1="./pentest_tmux [session start directory] [VPN file directory]"
usage2="Create a tmux session with dankerdolan's preferred settings."
usage3="If passing with no arguments, make sure you have a ~/Practice/htb/rooms/ and a ~/Practice/htb/vpn_files directory."
if [ "$#" -eq 0 ]; then
	no_args=true
elif [ "$#" -eq 1 ]; then
	one_arg=true
	if [ "$1" = "--help" ] || [ "$1" = "-h" ]; then
		echo $usage0
		printf "\t" 
		echo $usage1
		echo $usage2
		echo $usage3
		exit 0
	fi
elif [ "$#" -eq 2 ]; then
    	two_args=true
elif [ "$#" -gt 2 ]; then
    echo "Too many arguments provided, use -h or --help for usage info."
    exit 1
fi

# both default paths used
if $no_args; then
	FINAL_STATUS="[x] Argument not passed, default path(~/Practice/htb and ~/Practice/vpn_files) used."
	cd ~/Practice/htb/rooms
	VPN_PATH="~/Practice/vpn_files"
# path given by user, vpn path default
elif $one_arg; then
	FINAL_STATUS="[*] Path set to $1. VPN Path set to default: ~/Practice/vpn_files."; sleep 1;
	if [ -d "$1" ]
       	then
		cd $1
		VPN_PATH="~/Practice/vpn_files"
	else
		echo "[*] Session starting directory did not exist. Creating $1..."; sleep 1;
		mkdir $1 2>/dev/null
		if [ -d "$1" ]
		then
			echo "[*] Session starting directory created, path set to $1."; sleep 1;
			VPN_PATH="~/Practice/vpn_files"
			cd $1
		else
			echo "[x] $1 could not be made, aborting."
			exit 1
		fi
	fi

# both paths given by user
elif $two_args; then
	FINAL_STATUS="[*] Path set to $1. VPN Path set to $2."
	# both paths exist
	if [ -d "$1" ] && [ -d "$2" ]	
	then
		cd $1
		VPN_PATH="$2"
	# vpn path does not exist
	elif [ -d "$1" ] && [ ! -d "$2" ]
	then
		cd $1
		mkdir $2 2>/dev/null
		echo "[*] VPN directory did not exist. Creating $2..."; sleep 1;
		# vpn path successfully created
		if [ -d "$2" ]
		then
			echo "[*] VPN directory created, VPN path set to $1."; sleep 1;
			VPN_PATH="$2"
		# vpn path could not be made
		else
			echo "[x] VPN directory could not be made, aborting."
			exit 1
		fi
	# session start path does not exist
	
	elif [ ! -d "$1" ] && [ -d "$2" ]
	then
		mkdir $1 2>/dev/null
		echo "[*] Session starting directory did not exist. Creating $1..."; sleep 1;
		# session start path successfully created
		if [ -d "$1" ]
		then
			echo "[*] Session starting directory created, path set to $1."; sleep 1;
			cd $1
			VPN_PATH="$2"
		# session start path could not be made
		else
			echo "[x] $1 could not be made, aborting."
			exit 1
		fi
	
	# both paths do not exist
	elif [ ! -d "$1" ] && [ ! -d "$2" ]
	then
		echo "[*] Session starting directory did not exist. Creating $1..."; sleep 1;
		mkdir $1 2>/dev/null
		# session start path successfully made
		if [ -d "$1" ]
		then
			echo "[*] Path Directory created, path set to $1."; sleep 1;
			cd $1
			echo "[*] VPN directory did not exist. Creating $2..."; sleep 1;

			mkdir $2 2>/dev/null
		else
			echo "[x] $1 could not be made, aborting."
			exit 1
		fi
		# VPN path successfully made
		if [ -d "$2" ]
		then
			echo "[*] VPN Directory created, VPN path set to $2."
			VPN_PATH=$2
			sleep 1
		else
			echo "[x] $2 could not be made, aborting."
			exit 1
		fi

	fi

		

fi

echo $FINAL_STATUS; sleep 1;
session="pentest"

tmux new-session -d -s $session -n 'main'
tmux split-window -h
tmux split-window -v -p 33
tmux send-keys "tty-clock" Enter
tmux new-window -d -t '=pentest' -n 'second'
tmux select-window -t $session:1
tmux split-window -h
tmux new-window -d -t '=pentest' -n 'openvpn'
tmux select-window -t $session:2
tmux send-keys "cd $VPN_PATH" Enter
tmux select-window -t $session:0
tmux select-pane -t 0
tmux attach
